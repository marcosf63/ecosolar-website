# Configuração global (deve vir primeiro)
{
    # Email para Let's Encrypt (descomente para produção)
    # email seu-email@exemplo.com
    
    # Servidor de log de erros
    log {
        level INFO
    }
}

# Configuração para desenvolvimento local
localhost:80 {
    reverse_proxy ecosolar-web:3000
    
    # Headers de segurança
    header {
        # Remove headers do servidor
        -Server
        
        # Headers de segurança
        X-Content-Type-Options nosniff
        X-Frame-Options DENY
        X-XSS-Protection "1; mode=block"
        Referrer-Policy "strict-origin-when-cross-origin"
        
        # CSP básico
        Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline' fonts.googleapis.com; font-src 'self' fonts.gstatic.com; img-src 'self' data: https:; connect-src 'self';"
        
        # Cache para assets estáticos
        Cache-Control "public, max-age=3600"
    }
    
    # Configurações específicas para assets do Next.js
    handle /_next/static/* {
        header Cache-Control "public, max-age=31536000, immutable"
        reverse_proxy ecosolar-web:3000
    }
    
    # Configurações para imagens e outros assets
    handle /favicon.ico {
        header Cache-Control "public, max-age=86400"
        reverse_proxy ecosolar-web:3000
    }
    
    # Compressão automática (Caddy faz isso por padrão)
    encode gzip zstd
}

# Configuração para produção (descomente e configure seu domínio)
# seu-dominio.com {
#     reverse_proxy ecosolar-web:3000
#     
#     # HTTPS automático (Let's Encrypt)
#     # Caddy configura automaticamente
#     
#     # Headers de segurança para produção
#     header {
#         -Server
#         X-Content-Type-Options nosniff
#         X-Frame-Options DENY
#         X-XSS-Protection "1; mode=block"
#         Referrer-Policy "strict-origin-when-cross-origin"
#         Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
#         Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline' fonts.googleapis.com; font-src 'self' fonts.gstatic.com; img-src 'self' data: https:; connect-src 'self';"
#     }
#     
#     # Cache otimizado para produção
#     handle /_next/static/* {
#         header Cache-Control "public, max-age=31536000, immutable"
#         reverse_proxy ecosolar-web:3000
#     }
#     
#     handle /favicon.ico {
#         header Cache-Control "public, max-age=86400"
#         reverse_proxy ecosolar-web:3000
#     }
#     
#     encode gzip zstd
# }